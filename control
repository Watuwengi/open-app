{
  "name": "mylink-zeroapp",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "socket.io": "^4.7.2",
    "nodemailer": "^6.9.0",
    "qrcode": "^1.5.3"
  }
}const express = require('express');
const http = require('http');
const { Server } = require('socket.io');
const nodemailer = require('nodemailer');
const QRCode = require('qrcode');
const crypto = require('crypto');

const app = express();
const server = http.createServer(app);
const io = new Server(server, { cors: { origin: "*" } });

app.use(express.static('public'));

// Connections storage
const connections = new Map();

// Email transporter
const transporter = nodemailer.createTransporter({
  service: 'gmail',
  auth: {
    user: 'your@gmail.com',  // REPLACE WITH YOURS
    pass: 'your-app-password'  // GET FROM GOOGLE APP PASSWORDS
  }
});

// Dashboard
app.get('/', (req, res) => {
  res.sendFile(__dirname + '/public/dashboard.html');
});

// Phone page
app.get('/phone', (req, res) => {
  const token = req.query.token || crypto.randomBytes(16).toString('hex');
  res.send(`
    <h2>Connecting...</h2>
    <video id="local" autoplay muted width="100%"></video>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      navigator.mediaDevices.getDisplayMedia({video: true, audio: true}).then(stream => {
        document.getElementById('local').srcObject = stream;
        const pc = new RTCPeerConnection();
        stream.getTracks().forEach(t => pc.addTrack(t, stream));
        pc.createOffer().then(offer => {
          pc.setLocalDescription(offer);
          socket.emit('offer', offer);
        });
        socket.on('answer', answer => pc.setRemoteDescription(answer));
        pc.onicecandidate = e => e.candidate && socket.emit('ice', e.candidate);
      });
      socket.on('offer', offer => {
        const pc = new RTCPeerConnection();
        pc.setRemoteDescription(offer);
        pc.createAnswer().then(answer => {
          pc.setLocalDescription(answer);
          socket.emit('answer', answer);
        });
        pc.onicecandidate = e => e.candidate && socket.emit('ice', e.candidate);
        pc.ontrack = e => {
          const video = document.createElement('video');
          video.srcObject = e.streams[0];
          video.autoplay = true;
          document.body.appendChild(video);
        };
      });
    </script>
  `);
});

// Send magic link
app.get('/link', (req, res) => {
  const { email, phone } = req.query;
  const token = crypto.randomBytes(16).toString('hex');
  const url = `${req.protocol}://${req.get('host')}/phone?token=${token}`;
  connections.set(token, { email, phone });

  if (email) {
    transporter.sendMail({
      to: email,
      subject: 'MyLink: Connect Your Phone',
      html: `<a href="${url}">Click to connect: ${url}</a>`
    }).then(() => res.send('Email sent!'));
  } else if (phone) {
    // SMS placeholder - add Twilio for real SMS
    res.send(`SMS sent to ${phone} (Twilio setup needed)`);
  } else {
    res.send('Enter email or phone.');
  }
});

io.on('connection', (socket) => {
  console.log('Device connected');
  socket.on('offer', (data) => socket.broadcast.emit('offer', data));
  socket.on('answer', (data) => socket.broadcast.emit('answer', data));
  socket.on('ice', (data) => socket.broadcast.emit('ice', data));
  socket.on('disconnect', () => console.log('Device disconnected'));
});

server.listen(process.env.PORT || 3000, () => console.log('MyLink running!'));<!DOCTYPE html>
<html>
<head>
  <title>MyLink Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; border: 1px solid #ccc; }
    button { background: #007bff; color: white; cursor: pointer; }
    video { width: 100%; max-width: 600px; border: 1px solid #ccc; }
    #status { margin: 10px 0; padding: 10px; background: #e7f3ff; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>MyLink ZeroApp Dashboard</h1>
  <h3>Send Connection Link</h3>
  <input id="email" placeholder="your@gmail.com" />
  <button onclick="sendLink('email')">Send Email Link</button>
  <br>
  <input id="phone" placeholder="+254xxxxxxxxx" />
  <button onclick="sendLink('phone')">Send SMS Link</button>
  <div id="status"></div>

  <h3>Phone Screen</h3>
  <video id="remote" autoplay controls></video>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const pc = new RTCPeerConnection();

    socket.on('offer', offer => {
      pc.setRemoteDescription(offer);
      pc.createAnswer().then(answer => {
        pc.setLocalDescription(answer);
        socket.emit('answer', answer);
      });
    });

    pc.ontrack = e => document.getElementById('remote').srcObject = e.streams[0];

    function sendLink(type) {
      const value = document.getElementById(type).value;
      if (!value) return alert('Enter email or phone');
      fetch(`/link?${type}=${value}`)
        .then(r => r.text())
        .then(msg => document.getElementById('status').innerHTML = msg);
    }
  </script>
</body>
</html>
